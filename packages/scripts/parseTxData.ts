import { Hex, decodeFunctionData, formatEther } from "viem";
import { setupNetwork } from "./setupNetwork";

function tryDecodeFunctionData(abis, data) {
  for (const abi of abis) {
    try {
      return decodeFunctionData({ abi, data });
    } catch (e) {
      // console.log("Error decoding function data", e);
    }
  }
  throw new Error("No valid ABI found");
}

async function main() {
  const { publicClient, worldAddress, allAbis, account, txOptions, callTx } = await setupNetwork();

  const data =
    "0x8fc8cf7e0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000120000000000000000000000000ea6d65940734374ffd0cf85776773d5441e13b4e73795355420000000000000000000000455243323053797374656d000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044095ea7b30000000000000000000000004a59a566cf5f0042d68a3d274d237f0f2bd32cb60000000000000000000000000000000000000000000000000e043da61725000000000000000000000000000000000000000000000000000000000000000000000000000000000000ea6d65940734374ffd0cf85776773d5441e13b4e737900000000000000000000000000005472616e7366657253797374656d0000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000842f672b65000000000000000000000000000000000000000000000000000000000002e94c0000000000000000000000000000000000000000000000000000000000039ecc00000000000000000000000000000000000000000000000000000000000000a6000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000";

  const { functionName, args } = tryDecodeFunctionData(allAbis, data);

  console.log("Function Name:", functionName);
  if (functionName == "batchCallFrom") {
    for (const batchCallArgs of args[0]) {
      const callFromCallData = tryDecodeFunctionData(allAbis, batchCallArgs["callData"]);
      console.log("Call From Function Name:", callFromCallData.functionName);
      console.log("Call From Arguments:", callFromCallData.args);
    }
  } else if (functionName == "callFrom") {
    const callFromCallData = tryDecodeFunctionData(allAbis, args[2]);
    console.log("Call From Function Name:", callFromCallData.functionName);
    console.log("Call From Arguments:", callFromCallData.args);
  }
}

main();
